<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>R√©sidence Thalassa ¬∑ Copropri√©t√© √éle aux Bahamas</title>
  <style>
    :root {
      --blue: #0f7bff;
      --purple: #8245ff;
      --green: #12b886;
      --amber: #f59f00;
      --red: #f03e3e;
      --bg: #eef4ff;
      --text: #0f172a;
      --muted: #4b5563;
      --card: rgba(255, 255, 255, 0.9);
      --shadow: 0 18px 40px rgba(15, 27, 45, 0.18);
    }

    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: "Inter", system-ui, -apple-system, sans-serif;
      background: radial-gradient(circle at 18% 20%, #d7e8ff 0, #b2d4ff 25%, #7fb3ff 55%, #3a6cf6 100%);
      color: var(--text);
      min-height: 100vh;
    }

    .page {
      max-width: 1200px;
      margin: 0 auto;
      padding: 28px 18px 64px;
    }

    header {
      position: sticky;
      top: 0;
      z-index: 30;
      padding-bottom: 18px;
      backdrop-filter: blur(14px);
    }

    .nav {
      background: rgba(255, 255, 255, 0.92);
      border: 1px solid rgba(255, 255, 255, 0.6);
      border-radius: 18px;
      padding: 14px 18px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      box-shadow: var(--shadow);
    }

    .nav-links {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      color: var(--muted);
      font-weight: 600;
    }
    .nav-links a {
      text-decoration: none;
      color: inherit;
      padding: 8px 10px;
      border-radius: 10px;
      transition: background 0.2s ease, color 0.2s ease;
    }
    .nav-links a:hover { background: rgba(15, 123, 255, 0.08); color: var(--text); }

    .brand {
      display: flex;
      gap: 12px;
      align-items: center;
      font-weight: 800;
      letter-spacing: 0.04em;
      color: var(--blue);
    }

    .brand .pill {
      padding: 8px 12px;
      border-radius: 999px;
      background: linear-gradient(135deg, var(--blue), var(--purple));
      color: #fff;
      font-size: 12px;
      font-weight: 700;
    }

    .nav-actions { display: flex; gap: 8px; flex-wrap: wrap; }

    button {
      border: none;
      cursor: pointer;
      font-weight: 700;
      border-radius: 12px;
      transition: transform 0.18s ease, box-shadow 0.18s ease, background 0.18s ease;
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--blue), var(--purple));
      color: white;
      padding: 12px 16px;
      box-shadow: 0 12px 30px rgba(15, 123, 255, 0.3);
    }

    .btn-ghost {
      background: rgba(15, 123, 255, 0.08);
      color: var(--blue);
      padding: 11px 14px;
      border: 1px solid rgba(15, 123, 255, 0.18);
    }

    button:hover { transform: translateY(-1px); box-shadow: var(--shadow); }

    .grid { display: grid; gap: 18px; }

    .hero {
      background: linear-gradient(135deg, rgba(255, 255, 255, 0.97), rgba(255, 255, 255, 0.9));
      padding: 26px;
      border-radius: 20px;
      border: 1px solid rgba(255, 255, 255, 0.7);
      box-shadow: var(--shadow);
      display: grid;
      gap: 16px;
    }

    .hero h1 { margin: 0; font-size: clamp(30px, 5vw, 44px); color: var(--text); }
    .hero p { margin: 6px 0 0; color: var(--muted); line-height: 1.6; }

    .section {
      background: var(--card);
      border-radius: 18px;
      padding: 20px;
      border: 1px solid rgba(255, 255, 255, 0.75);
      box-shadow: var(--shadow);
    }

    .section h2 { margin: 0 0 10px; color: var(--text); }
    .section .subtitle { color: var(--muted); margin-bottom: 12px; }

    .chips { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 8px; }
    .chip {
      padding: 8px 12px;
      border-radius: 12px;
      background: rgba(255, 255, 255, 0.72);
      border: 1px solid rgba(0, 0, 0, 0.05);
      color: var(--muted);
    }

    .kpis { display: grid; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr)); gap: 10px; }
    .kpi {
      background: rgba(255, 255, 255, 0.9);
      border: 1px solid rgba(255, 255, 255, 0.7);
      border-radius: 14px;
      padding: 12px;
      box-shadow: var(--shadow);
      display: grid;
      gap: 6px;
    }
    .kpi .label { color: var(--muted); font-size: 13px; }
    .kpi .value { font-size: 22px; font-weight: 800; color: var(--text); }

    .lot-toolbar { display: flex; gap: 10px; align-items: center; flex-wrap: wrap; margin-bottom: 14px; }
    .filter {
      padding: 8px 12px;
      border-radius: 10px;
      background: rgba(15, 123, 255, 0.1);
      color: var(--blue);
      border: 1px solid rgba(15, 123, 255, 0.2);
      cursor: pointer;
    }

    .lot-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 12px; }

    .lot-card {
      padding: 14px;
      border-radius: 14px;
      background: linear-gradient(145deg, rgba(255, 255, 255, 0.96), rgba(255, 255, 255, 0.86));
      border: 1px solid rgba(0, 0, 0, 0.04);
      box-shadow: 0 10px 24px rgba(0, 0, 0, 0.08);
      display: grid;
      gap: 8px;
    }

    .lot-head { display: flex; justify-content: space-between; align-items: center; gap: 6px; }
    .badge {
      border-radius: 999px;
      padding: 6px 10px;
      font-size: 12px;
      font-weight: 800;
      color: #fff;
    }
    .b-dispo { background: var(--green); }
    .b-reserve { background: var(--amber); }
    .b-indispo { background: var(--red); }

    .meta { color: var(--muted); font-size: 14px; }

    .tab-wrapper { margin: 18px 0; }
    .tabs { display: flex; gap: 10px; flex-wrap: wrap; }
    .tab {
      padding: 10px 12px;
      border-radius: 12px;
      border: 1px solid rgba(0,0,0,0.05);
      background: rgba(255,255,255,0.8);
      cursor: pointer;
      font-weight: 700;
      color: var(--muted);
    }
    .tab.active { background: linear-gradient(135deg, rgba(15,123,255,0.1), rgba(130,69,255,0.12)); color: var(--text); border-color: rgba(15,123,255,0.22); }

    .tab-panels { margin-top: 12px; }
    .tab-panel { display: none; background: rgba(255,255,255,0.88); border-radius: 14px; padding: 14px; border: 1px solid rgba(0,0,0,0.04); box-shadow: var(--shadow); }
    .tab-panel.active { display: grid; gap: 10px; }

    .accordion { border: 1px solid rgba(0,0,0,0.05); border-radius: 12px; overflow: hidden; }
    .accordion-item + .accordion-item { border-top: 1px solid rgba(0,0,0,0.05); }
    .accordion-header { padding: 12px 14px; background: rgba(255,255,255,0.85); display: flex; justify-content: space-between; align-items: center; cursor: pointer; font-weight: 700; }
    .accordion-content { padding: 0 14px 14px; display: none; color: var(--muted); line-height: 1.5; }
    .accordion-item.open .accordion-content { display: block; }

    .badge-soft { padding: 6px 10px; border-radius: 10px; background: rgba(15,123,255,0.08); color: var(--blue); font-weight: 700; }
    .grid-cards { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 12px; }
    .card-sm { background: rgba(255,255,255,0.9); border-radius: 12px; padding: 12px; border: 1px solid rgba(0,0,0,0.05); box-shadow: var(--shadow); display: grid; gap: 6px; }
    .flag { display: inline-flex; align-items: center; gap: 6px; font-weight: 800; }

    form { display: grid; gap: 14px; }
    label { display: grid; gap: 6px; font-weight: 700; color: var(--text); }
    input, select, textarea {
      border: 1px solid rgba(0, 0, 0, 0.08);
      border-radius: 12px;
      padding: 12px;
      background: rgba(255, 255, 255, 0.9);
      font-size: 15px;
      font-family: inherit;
      color: var(--text);
      box-shadow: inset 0 2px 6px rgba(15, 27, 45, 0.04);
    }
    textarea { min-height: 110px; resize: vertical; }

    .two-col { display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 12px; }

    .table { width: 100%; border-collapse: collapse; }
    .table th, .table td { text-align: left; padding: 10px 8px; }
    .table th { color: var(--muted); font-weight: 700; font-size: 13px; }
    .table tr { background: rgba(255, 255, 255, 0.7); border-radius: 10px; }
    .table tr + tr td { border-top: 1px solid rgba(0, 0, 0, 0.05); }
    .table td input, .table td select, .table td textarea { width: 100%; font-size: 14px; }

    .admin-bar { display: flex; justify-content: space-between; align-items: center; gap: 12px; flex-wrap: wrap; }
    .status-dot { width: 10px; height: 10px; border-radius: 50%; display: inline-block; }
    .toast {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: #fff;
      border-radius: 12px;
      padding: 14px 16px;
      box-shadow: var(--shadow);
      color: var(--text);
      opacity: 0;
      transform: translateY(10px);
      transition: 0.2s ease;
      z-index: 50;
    }
    .toast.show { opacity: 1; transform: translateY(0); }

    .pill-list { display: flex; flex-wrap: wrap; gap: 6px; }
    .pill-box { background: rgba(15, 123, 255, 0.06); color: var(--text); padding: 8px 10px; border-radius: 10px; }

    .hidden { display: none !important; }

    @media (max-width: 720px) {
      .nav { flex-direction: column; align-items: flex-start; }
      .lot-head { flex-direction: column; align-items: flex-start; }
    }
  </style>
</head>
<body>
  <div class="page">
    <header>
      <div class="nav">
        <div class="brand">
          <div class="pill">√éle aux Bahamas</div>
          <div>R√©sidence Thalassa</div>
        </div>
        <div class="nav-links">
          <a href="#hero">Accueil</a>
          <a href="#tabs">Onglets</a>
          <a href="#lots">Lots</a>
          <a href="#services">Services</a>
          <a href="#agenda">Agenda</a>
          <a href="#faq">FAQ</a>
        </div>
        <div class="nav-actions">
          <button class="btn-ghost" onclick="downloadReglement()">üìÑ T√©l√©charger le r√®glement</button>
          <button class="btn-primary" onclick="openAdmin()">üîê Espace administrateur</button>
        </div>
      </div>
    </header>

    <section id="hero" class="hero">
      <div>
        <h1>Cabanons sur pilotis ¬∑ r√©sidence priv√©e & partag√©e</h1>
        <p>Plage, ponton, terrain de beach-volley et golf, port privatif : la copropri√©t√© Thalassa offre un cadre exceptionnel pour vivre le r√™ve des Bahamas. Suivez les disponibilit√©s, demandez des informations et laissez l'√©quipe g√©rer les lots en temps r√©el.</p>
      </div>
      <div class="chips">
        <div class="chip">Ponton / plage / port privatif</div>
        <div class="chip">Terrain de beach-volley & golf</div>
        <div class="chip">R√®glement clair ¬∑ respect de la faune</div>
        <div class="chip">Administration s√©curis√©e TALASSA</div>
      </div>
      <div class="kpis" id="kpiRow"></div>
    </section>

    <section id="tabs" class="section">
      <div class="tab-wrapper">
        <div class="tabs" id="tabsNav"></div>
        <div class="tab-panels" id="tabsPanels"></div>
      </div>
    </section>

    <section class="section" id="services">
      <h2>Services sur site et confort quotidien</h2>
      <p class="subtitle">Des onglets d√©di√©s aux loisirs, √† la logistique et aux garanties pour un site digne d'un vrai resort.</p>
      <div class="grid-cards" id="servicesGrid"></div>
    </section>

    <section class="section" id="agenda">
      <h2>Agenda & jalons</h2>
      <p class="subtitle">Toutes les √©tapes pour la pr√©sentation orale du 28 novembre et le suivi de la copropri√©t√©.</p>
      <div class="grid-cards">
        <div class="card-sm">
          <div class="flag">üé§ Pr√©sentation orale</div>
          <div class="meta">28 novembre ¬∑ Copro physiquement</div>
          <div class="badge-soft">Salle & lieu confirm√©s une semaine avant</div>
        </div>
        <div class="card-sm">
          <div class="flag">üìë R√®glement</div>
          <div class="meta">Niveau 5/6 ¬∑ EDD et composition inclus</div>
          <div class="badge-soft">T√©l√©chargeable, mis √† jour √† chaque r√©vision</div>
        </div>
        <div class="card-sm">
          <div class="flag">üõ•Ô∏è Parties communes</div>
          <div class="meta">Ponton, plage, port privatif, terrains sportifs</div>
          <div class="badge-soft">D√©finition & conditions de jouissance</div>
        </div>
        <div class="card-sm">
          <div class="flag">üìå Lieu</div>
          <div class="meta">√éle aux Bahamas ¬∑ R√©sidence Thalassa</div>
          <div class="badge-soft">Acc√®s bateau + a√©rien d√©taill√© dans les onglets</div>
        </div>
      </div>
    </section>

    <section class="section" id="lots">
      <div class="lot-toolbar">
        <h2>Lots disponibles / indisponibles</h2>
        <div class="pill-list">
          <div class="pill-box">Filtrer :</div>
          <button class="filter" onclick="setFilter('all')">Tous</button>
          <button class="filter" onclick="setFilter('Disponible')">Disponible</button>
          <button class="filter" onclick="setFilter('R√©serv√©')">R√©serv√©</button>
          <button class="filter" onclick="setFilter('Indisponible')">Indisponible</button>
        </div>
      </div>
      <div id="lotGrid" class="lot-grid"></div>
      <div style="margin-top:14px;" id="lotFocus" class="section" aria-live="polite"></div>
    </section>

    <section class="section">
      <div class="admin-bar">
        <div>
          <h2>Demande d'information</h2>
          <p class="subtitle">Les demandes sont sauvegard√©es automatiquement toutes les 30 secondes et √† chaque modification.</p>
        </div>
        <button class="btn-ghost" onclick="resetDraft()">R√©initialiser le brouillon</button>
      </div>
      <form id="requestForm">
        <div class="two-col">
          <label>Nom et pr√©nom
            <input name="name" required placeholder="Votre nom" />
          </label>
          <label>Email
            <input name="email" type="email" required placeholder="vous@example.com" />
          </label>
        </div>
        <div class="two-col">
          <label>T√©l√©phone
            <input name="phone" required placeholder="+33..." />
          </label>
          <label>Lot souhait√©
            <select name="lot" id="lotSelect" required></select>
          </label>
        </div>
        <label>Message
          <textarea name="message" placeholder="Pr√©cisez vos besoins, disponibilit√©s de visite, etc." required></textarea>
        </label>
        <button class="btn-primary" type="submit">Envoyer la demande</button>
        <div id="draftStatus" class="meta"></div>
      </form>
    </section>

    <section class="section">
      <h2>R√®glement de copropri√©t√©</h2>
      <p class="subtitle">Fixe la destination des parties privatives et communes, et les conditions de leur jouissance.</p>
      <ul class="meta">
        <li>Pas de bruit apr√®s 00h (respect du voisinage et de la faune locale).</li>
        <li>Animaux autoris√©s s‚Äôils ne troublent pas la tranquillit√©.</li>
        <li>Utilisation du port r√©serv√©e aux r√©sidents (1 place par cabanon).</li>
        <li>Plage et ponton : usage collectif, interdiction de privatiser des zones.</li>
        <li>Terrain de beach-volley & golf : r√©servation par cr√©neaux pour √©viter les conflits.</li>
        <li>Propret√© : chaque r√©sident veille √† la propret√© des lieux communs.</li>
        <li>Interdiction de feu de camp ou barbecue hors zones pr√©vues.</li>
      </ul>
      <div class="chips">
        <div class="chip">Pr√©sentation orale : 28 novembre</div>
        <div class="chip">Copro physiquement : lieu √† confirmer</div>
        <div class="chip">EDD & r√®glement : niveau 5/6</div>
        <div class="chip">Comit√© : composition en cours</div>
      </div>
      <div style="margin-top:12px;">
        <button class="btn-ghost" onclick="downloadReglement()">üì• Exporter le r√®glement (PDF)</button>
      </div>
    </section>

    <section class="section" id="faq">
      <h2>Questions fr√©quentes</h2>
      <div class="accordion" id="faqAccordion"></div>
    </section>

    <section id="adminPanel" class="section hidden">
      <div class="admin-bar">
        <h2>Administration TALASSA</h2>
        <button class="btn-ghost" onclick="logout()">Se d√©connecter</button>
      </div>
      <div class="subtitle">Modifier les statuts des lots et √©diter chaque demande envoy√©e. Tout est sauvegard√© localement et reste accessible hors connexion apr√®s authentification.</div>

      <h3>Statuts des lots</h3>
      <div id="adminLots" class="grid" style="grid-template-columns: repeat(auto-fit, minmax(260px,1fr));"></div>

      <h3>Demandes re√ßues</h3>
      <div class="section" style="padding:12px; background: rgba(255,255,255,0.8);">
        <table class="table" id="requestsTable"></table>
      </div>
    </section>
  </div>

  <div id="toast" class="toast"></div>

  <script>
    const lotKey = 'thalassa_lots_v2';
    const reqKey = 'thalassa_requests_v2';
    const draftKey = 'thalassa_draft_v2';
    let filter = 'all';
    let isAdmin = false;
    const defaultLots = [
      { id: 1, nom: 'Lot 1', type: 'T4', surface: '40 m¬≤', statut: 'Disponible', vue: 'Lagune', note: 'Acc√®s direct au ponton' },
      { id: 2, nom: 'Lot 2', type: 'T4', surface: '40 m¬≤', statut: 'Disponible', vue: 'Oc√©an', note: 'Proche plage principale' },
      { id: 3, nom: 'Lot 3', type: 'T4', surface: '40 m¬≤', statut: 'R√©serv√©', vue: 'Lagune', note: 'Expos√© coucher de soleil' },
      { id: 4, nom: 'Lot 4', type: 'T4', surface: '40 m¬≤', statut: 'Disponible', vue: 'Jardin', note: 'Calme, proche golf' },
      { id: 5, nom: 'Lot 5', type: 'T4', surface: '40 m¬≤', statut: 'Indisponible', vue: 'Oc√©an', note: 'R√©novation en cours' },
      { id: 6, nom: 'Lot 6', type: 'T4', surface: '40 m¬≤', statut: 'Disponible', vue: 'Lagune', note: 'Pontons priv√©s √† 50 m' },
      { id: 7, nom: 'Lot 7', type: 'T4', surface: '40 m¬≤', statut: 'Disponible', vue: 'Jardin', note: 'Pr√™t pour emm√©nagement' },
      { id: 8, nom: 'Lot 8', type: 'T4', surface: '40 m¬≤', statut: 'R√©serv√©', vue: 'Oc√©an', note: 'Double terrasse' },
      { id: 9, nom: 'Lot 9', type: 'T4', surface: '40 m¬≤', statut: 'Disponible', vue: 'Lagune', note: 'Id√©al famille' },
      { id: 10, nom: 'Lot 10', type: 'T4', surface: '40 m¬≤', statut: 'Disponible', vue: 'Oc√©an', note: 'Acc√®s plage nord' },
      { id: 11, nom: 'Lot 11', type: 'T4', surface: '40 m¬≤', statut: 'Indisponible', vue: 'Jardin', note: 'Maintenance' },
      { id: 12, nom: 'Lot 12', type: 'T4', surface: '40 m¬≤', statut: 'Disponible', vue: 'Lagune', note: 'Couchers de soleil' },
      { id: 13, nom: 'Lot 13', type: 'T4', surface: '40 m¬≤', statut: 'Disponible', vue: 'Jardin', note: 'Ombre et fra√Æcheur' },
      { id: 14, nom: 'Lot 14', type: 'T4', surface: '40 m¬≤', statut: 'R√©serv√©', vue: 'Oc√©an', note: 'Vue panoramique' },
      { id: 15, nom: 'Lot 15', type: 'T4', surface: '40 m¬≤', statut: 'Disponible', vue: 'Lagune', note: 'Pontons secondaires' },
      { id: 16, nom: 'Lot 16', type: 'T4', surface: '40 m¬≤', statut: 'Disponible', vue: 'Jardin', note: 'Proche terrain de golf' },
      { id: 17, nom: 'Lot 17', type: 'T4', surface: '40 m¬≤', statut: 'Disponible', vue: 'Oc√©an', note: 'Terrasse XL' },
      { id: 18, nom: 'Lot 18', type: 'T4', surface: '40 m¬≤', statut: 'Disponible', vue: 'Lagune', note: 'Pr√™t √† visiter' },
      { id: 19, nom: 'Lot 19', type: 'T4', surface: '40 m¬≤', statut: 'Indisponible', vue: 'Oc√©an', note: 'Bloc technique' },
      { id: 20, nom: 'Lot 20', type: 'T4', surface: '40 m¬≤', statut: 'Disponible', vue: 'Jardin', note: 'Id√©al coliving' },
      { id: 21, nom: 'Lot 21', type: 'T4', surface: '40 m¬≤', statut: 'R√©serv√©', vue: 'Lagune', note: 'Option investisseurs' },
      { id: 22, nom: 'Lot 22', type: 'T4', surface: '40 m¬≤', statut: 'Disponible', vue: 'Oc√©an', note: 'Tr√®s lumineux' },
      { id: 23, nom: 'Lot 23', type: 'T4', surface: '40 m¬≤', statut: 'Disponible', vue: 'Jardin', note: 'Accessible PMR' },
      { id: 24, nom: 'Lot 24', type: 'T4', surface: '40 m¬≤', statut: 'Disponible', vue: 'Lagune', note: 'Pr√™t pour location' },
      { id: 25, nom: 'Lot 25', type: 'T4', surface: '40 m¬≤', statut: 'Disponible', vue: 'Oc√©an', note: 'Spot premium' }
    ];

    const tabDefinitions = [
      { id: 'presentation', titre: 'Pr√©sentation', points: [
        '√éle aux Bahamas : cabanons sur pilotis pens√©s pour la copropri√©t√©',
        'Parties communes : ponton, plage, terrains de beach-volley & golf',
        'Port avec place de bateau privative pour chaque lot'
      ]},
      { id: 'reglement', titre: 'R√®glement', points: [
        'Pas de bruit apr√®s 00h ¬∑ respect du voisinage et de la faune locale',
        'Animaux autoris√©s s‚Äôils ne troublent pas la tranquillit√©',
        'Usage collectif des plages et pontons ¬∑ interdiction de privatiser'
      ]},
      { id: 'jouissance', titre: 'Jouissance', points: [
        'D√©termine la destination des parties privatives et communes',
        'Conditions d‚Äôutilisation du port : 1 place par cabanon',
        'R√©servation par cr√©neau pour le beach-volley & golf'
      ]},
      { id: 'logistique', titre: 'Acc√®s & logistique', points: [
        'Navettes bateau programm√©es ¬∑ station d‚Äôaccueil s√©curis√©e',
        'Accueil bagagerie, conciergerie et maintenance sur place',
        'Bornes √©lectriques et zones techniques d√©di√©es'
      ]},
      { id: 'invest', titre: 'Investissement', points: [
        'Lots T4 de 40 m¬≤ optimis√©s pour la location premium',
        'Statuts ‚ÄúDisponible / R√©serv√© / Indisponible‚Äù mis √† jour en temps r√©el',
        'Sauvegarde locale pour consultation hors connexion'
      ]},
      { id: 'documents', titre: 'Documents', points: [
        'R√®glement t√©l√©chargeable en PDF',
        'EDD et composition annex√©s',
        'Compte-rendus de visites et de pr√©sentation' ]}
    ];

    const services = [
      { icon: 'üèùÔ∏è', titre: 'Acc√®s plage & ponton', texte: 'Pass prioritaire pour les r√©sidents, surveillance et √©clairage doux nocturne.' },
      { icon: '‚õµ', titre: 'Port privatif', texte: 'Place d√©di√©e par cabanon, badges s√©curis√©s, assistance amarrage.' },
      { icon: 'üèê', titre: 'Sports & loisirs', texte: 'Terrain de beach-volley & golf en r√©servation par cr√©neau via l‚Äôonglet loisirs.' },
      { icon: 'üßπ', titre: 'Propret√© & maintenance', texte: '√âquipe de m√©nage tournante, rappel automatique des r√®gles de propret√©.' },
      { icon: 'ü¶ú', titre: 'Respect de la faune', texte: 'Silence apr√®s minuit, √©clairage basse intensit√©, indicateurs ‚Äúqui√©tude‚Äù.' },
      { icon: 'üõ∞Ô∏è', titre: 'Connectivit√©', texte: 'Wifi maill√©, sauvegarde locale des demandes et des statuts pour usage hors connexion.' },
      { icon: 'üõü', titre: 'S√©curit√©', texte: 'Vid√©osurveillance discr√®te, num√©ros d‚Äôurgence et d√©fibrillateur signal√©s.' },
      { icon: 'üß≠', titre: 'Conciergerie', texte: 'R√©servations activit√©s, transferts a√©roport, √©quipements suppl√©mentaires sur demande.' }
    ];

    const faq = [
      { q: 'Comment acc√©der √† la r√©sidence ?', a: 'Par navette bateau d√©di√©e (port privatif) ou par l‚Äôa√©roport voisin avec transfert organis√© par la conciergerie.' },
      { q: 'Puis-je venir avec des animaux ?', a: 'Oui, s‚Äôils ne troublent pas la tranquillit√©. Les promenades sont conseill√©es en dehors des zones calmes apr√®s 20h.' },
      { q: 'Comment r√©server les terrains de sport ?', a: 'Choisissez un cr√©neau dans l‚Äôonglet Sports & Loisirs, confirmation instantan√©e et rappel push.' },
      { q: 'Les demandes clients sont-elles publiques ?', a: 'Non. Seuls les administrateurs connect√©s (TALASSA / TALASSAVIVEZLEREVE) peuvent consulter et √©diter les demandes.' },
      { q: 'Puis-je modifier le statut d‚Äôun lot ?', a: 'Oui depuis l‚Äôespace administrateur : disponible, r√©serv√© ou indisponible. La mise √† jour est visible c√¥t√© public imm√©diatement.' }
    ];

    function loadLots() {
      return JSON.parse(localStorage.getItem(lotKey) || 'null') || defaultLots;
    }
    function saveLots(lots) { localStorage.setItem(lotKey, JSON.stringify(lots)); }

    function renderLots() {
      const lots = loadLots();
      const grid = document.getElementById('lotGrid');
      grid.innerHTML = '';
      lots.filter(l => filter === 'all' || l.statut === filter).forEach(lot => {
        const card = document.createElement('div');
        card.className = 'lot-card';
        card.innerHTML = `
          <div class="lot-head">
            <div><strong>${lot.nom}</strong></div>
            ${badge(lot.statut)}
          </div>
          <div class="meta">${lot.type} ¬∑ ${lot.surface} ¬∑ Vue ${lot.vue || 'lagon'}</div>
          <div class="meta">${lot.note || 'Acc√®s complet aux parties communes'}</div>
          <button class="btn-ghost" onclick="prefillLot('${lot.nom}')">Demander ce lot</button>
        `;
        card.addEventListener('click', () => focusLot(lot));
        grid.appendChild(card);
      });
      populateLotOptions(lots);
      renderAdminLots(lots);
      updateKpis();
    }

    function badge(status) {
      const cls = status === 'Disponible' ? 'b-dispo' : status === 'R√©serv√©' ? 'b-reserve' : 'b-indispo';
      return `<span class="badge ${cls}">${status}</span>`;
    }

    function populateLotOptions(lots) {
      const sel = document.getElementById('lotSelect');
      sel.innerHTML = '<option value="">S√©lectionner un lot</option>' + lots.map(l => `<option value="${l.nom}">${l.nom} (${l.statut})</option>`).join('');
    }

    function prefillLot(name) {
      document.querySelector('select[name="lot"]').value = name;
      document.querySelector('form').scrollIntoView({ behavior: 'smooth' });
      const lots = loadLots();
      const selected = lots.find(l => l.nom === name);
      if (selected) focusLot(selected);
    }

    function setFilter(value) { filter = value; renderLots(); }

    function loadRequests() {
      return JSON.parse(localStorage.getItem(reqKey) || '[]');
    }
    function saveRequests(reqs) { localStorage.setItem(reqKey, JSON.stringify(reqs)); }

    function submitRequest(e) {
      e.preventDefault();
      const form = e.target;
      const data = Object.fromEntries(new FormData(form).entries());
      const requests = loadRequests();
      requests.push({ ...data, statut: 'Nouvelle', id: crypto.randomUUID(), date: new Date().toISOString() });
      saveRequests(requests);
      localStorage.removeItem(draftKey);
      form.reset();
      document.getElementById('draftStatus').textContent = 'Demande enregistr√©e et envoy√©e au gestionnaire.';
      toast('Demande envoy√©e. Elle est visible par l\'administrateur uniquement.');
      renderRequests();
    }

    function renderRequests() {
      if (!isAdmin) return;
      const table = document.getElementById('requestsTable');
      const reqs = loadRequests();
      if (!reqs.length) {
        table.innerHTML = '<tr><td class="meta">Aucune demande pour le moment.</td></tr>';
        return;
      }
      table.innerHTML = `
        <tr>
          <th>Nom</th><th>Email</th><th>T√©l√©phone</th><th>Lot</th><th>Message</th><th>Statut</th>
        </tr>
      ` + reqs.map(r => `
        <tr>
          <td><input value="${r.name || ''}" data-id="${r.id}" data-field="name" /></td>
          <td><input value="${r.email || ''}" data-id="${r.id}" data-field="email" /></td>
          <td><input value="${r.phone || ''}" data-id="${r.id}" data-field="phone" /></td>
          <td><input value="${r.lot || ''}" data-id="${r.id}" data-field="lot" /></td>
          <td><textarea data-id="${r.id}" data-field="message">${r.message || ''}</textarea></td>
          <td>
            <select data-id="${r.id}" data-field="statut">
              ${['Nouvelle','En cours','Cl√¥tur√©e'].map(s => `<option ${s===r.statut?'selected':''}>${s}</option>`).join('')}
            </select>
          </td>
        </tr>
      `).join('');
      table.querySelectorAll('input, textarea, select').forEach(el => el.addEventListener('change', editRequest));
    }

    function updateKpis() {
      const lots = loadLots();
      const dispo = lots.filter(l => l.statut === 'Disponible').length;
      const reserve = lots.filter(l => l.statut === 'R√©serv√©').length;
      const indispo = lots.filter(l => l.statut === 'Indisponible').length;
      document.getElementById('kpiRow').innerHTML = `
        <div class="kpi"><div class="label">Lots disponibles</div><div class="value">${dispo}</div></div>
        <div class="kpi"><div class="label">R√©serv√©s</div><div class="value">${reserve}</div></div>
        <div class="kpi"><div class="label">Indisponibles</div><div class="value">${indispo}</div></div>
        <div class="kpi"><div class="label">Demandes re√ßues</div><div class="value">${loadRequests().length}</div></div>
      `;
    }

    function focusLot(lot) {
      const target = document.getElementById('lotFocus');
      target.innerHTML = `
        <h3>${lot.nom} ¬∑ ${lot.surface}</h3>
        <div class="chips">
          <div class="chip">${lot.type}</div>
          <div class="chip">Vue ${lot.vue || 'lagon'}</div>
          <div class="chip">Statut : ${lot.statut}</div>
        </div>
        <p class="meta">${lot.note || 'Acc√®s complet aux parties communes'}</p>
        <div class="grid-cards">
          <div class="card-sm"><div class="flag">‚öì Port</div><div class="meta">Place privative incluse</div></div>
          <div class="card-sm"><div class="flag">üèùÔ∏è Plage & ponton</div><div class="meta">Acc√®s collectif, pas de privatisation</div></div>
          <div class="card-sm"><div class="flag">üèê Sports</div><div class="meta">Beach-volley & golf sur r√©servation</div></div>
        </div>
      `;
    }

    function renderTabs() {
      const nav = document.getElementById('tabsNav');
      const panels = document.getElementById('tabsPanels');
      nav.innerHTML = tabDefinitions.map((t, i) => `<button class="tab ${i===0?'active':''}" data-tab="${t.id}">${t.titre}</button>`).join('');
      panels.innerHTML = tabDefinitions.map((t, i) => `
        <div class="tab-panel ${i===0?'active':''}" data-tab="${t.id}">
          ${t.points.map(p => `<div class="meta">‚Ä¢ ${p}</div>`).join('')}
        </div>
      `).join('');
      nav.querySelectorAll('.tab').forEach(btn => btn.addEventListener('click', () => setTab(btn.dataset.tab)));
    }

    function setTab(tabId) {
      document.querySelectorAll('.tab').forEach(t => t.classList.toggle('active', t.dataset.tab === tabId));
      document.querySelectorAll('.tab-panel').forEach(p => p.classList.toggle('active', p.dataset.tab === tabId));
    }

    function renderServices() {
      const grid = document.getElementById('servicesGrid');
      grid.innerHTML = services.map(s => `
        <div class="card-sm">
          <div class="flag">${s.icon} ${s.titre}</div>
          <div class="meta">${s.texte}</div>
        </div>
      `).join('');
    }

    function renderFaq() {
      const wrap = document.getElementById('faqAccordion');
      wrap.innerHTML = faq.map((f, i) => `
        <div class="accordion-item ${i===0?'open':''}">
          <div class="accordion-header">${f.q}<span>${i===0?'-':'+'}</span></div>
          <div class="accordion-content">${f.a}</div>
        </div>
      `).join('');
      wrap.querySelectorAll('.accordion-item').forEach(item => {
        item.querySelector('.accordion-header').addEventListener('click', () => {
          const open = item.classList.toggle('open');
          item.querySelector('span').textContent = open ? '-' : '+';
        });
      });
    }

    function editRequest(e) {
      const { id, field } = e.target.dataset;
      const reqs = loadRequests();
      const idx = reqs.findIndex(r => r.id === id);
      if (idx === -1) return;
      reqs[idx][field] = e.target.value;
      saveRequests(reqs);
      toast('Demande mise √† jour et publi√©e hors connexion.');
    }

    function renderAdminLots(lots) {
      if (!isAdmin) return;
      const container = document.getElementById('adminLots');
      container.innerHTML = '';
      lots.forEach((lot, index) => {
        const card = document.createElement('div');
        card.className = 'lot-card';
        card.innerHTML = `
          <div class="lot-head"><strong>${lot.nom}</strong>${badge(lot.statut)}</div>
          <div class="meta">${lot.type} ¬∑ ${lot.surface}</div>
          <label>Statut
            <select data-index="${index}">
              ${['Disponible','R√©serv√©','Indisponible'].map(s => `<option ${s===lot.statut?'selected':''}>${s}</option>`).join('')}
            </select>
          </label>
        `;
        card.querySelector('select').addEventListener('change', (e) => {
          const lotsList = loadLots();
          lotsList[index].statut = e.target.value;
          saveLots(lotsList);
          renderLots();
          toast('Statut du lot mis √† jour.');
        });
        container.appendChild(card);
      });
    }

    function downloadReglement() {
      const content = `R√©sidence Thalassa - R√®glement de copropri√©t√©\n\n` +
        `Parties communes : ponton, plage, terrain de beach-volley/golf, port (place de bateau privative).\n` +
        `D√©termine la destination des parties privatives et communes et fixe les r√®gles de jouissance.\n\n` +
        `R√®gles :\n` +
        `- Pas de bruit apr√®s 00h (respect du voisinage et de la faune locale).\n` +
        `- Animaux autoris√©s s‚Äôils ne troublent pas la tranquillit√©.\n` +
        `- Utilisation du port r√©serv√©e aux r√©sidents (1 place par cabanon).\n` +
        `- Plage et ponton : usage collectif, interdiction de privatiser des zones.\n` +
        `- Terrain de beach-volley & golf : r√©servation par cr√©neaux pour √©viter les conflits.\n` +
        `- Propret√© : chaque r√©sident veille √† la propret√© des lieux communs.\n` +
        `- Interdiction de feu de camp ou barbecue hors zones pr√©vues.\n\n` +
        `Dates cl√©s : pr√©sentation orale le 28 novembre (copro physiquement, composition, r√®glement niveau 5/6, EDD, lieu).\n`;
      const blob = new Blob([content], { type: 'application/pdf' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'Reglement_Residence_Thalassa.pdf';
      a.click();
      URL.revokeObjectURL(url);
      toast('R√®glement PDF t√©l√©charg√©.');
    }

    function saveDraft() {
      const form = document.getElementById('requestForm');
      const data = Object.fromEntries(new FormData(form).entries());
      localStorage.setItem(draftKey, JSON.stringify({ data, date: new Date().toISOString() }));
      updateDraftStatus('Brouillon sauvegard√©.');
    }

    function restoreDraft() {
      const saved = JSON.parse(localStorage.getItem(draftKey) || 'null');
      if (!saved) return;
      const form = document.getElementById('requestForm');
      Object.entries(saved.data).forEach(([k, v]) => { if (form[k]) form[k].value = v; });
      updateDraftStatus(`Brouillon restaur√© (${new Date(saved.date).toLocaleTimeString()}).`);
    }

    function resetDraft() {
      document.getElementById('requestForm').reset();
      localStorage.removeItem(draftKey);
      updateDraftStatus('Brouillon r√©initialis√©.');
    }

    function updateDraftStatus(text) {
      document.getElementById('draftStatus').textContent = text;
    }

    function toast(message) {
      const t = document.getElementById('toast');
      t.textContent = message;
      t.classList.add('show');
      setTimeout(() => t.classList.remove('show'), 2400);
    }

    function openAdmin() {
      const login = prompt('Identifiant administrateur');
      const pwd = login ? prompt('Mot de passe') : '';
      if (login === 'TALASSA' && pwd === 'TALASSAVIVEZLEREVE') {
        isAdmin = true;
        document.getElementById('adminPanel').classList.remove('hidden');
        renderRequests();
        renderLots();
        toast('Connexion r√©ussie.');
      } else {
        alert('Identifiants incorrects. Acc√®s refus√©.');
      }
    }

    function logout() {
      isAdmin = false;
      document.getElementById('adminPanel').classList.add('hidden');
      toast('Vous √™tes d√©connect√©.');
    }

    document.getElementById('requestForm').addEventListener('submit', submitRequest);
    document.getElementById('requestForm').addEventListener('input', () => { saveDraft(); });
    setInterval(saveDraft, 30000);

    restoreDraft();
    renderTabs();
    renderServices();
    renderFaq();
    renderLots();
    const initialLot = loadLots().find(l => l.statut === 'Disponible') || loadLots()[0];
    if (initialLot) focusLot(initialLot);
  </script>
</body>
</html>
